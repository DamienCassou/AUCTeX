@SET_MAKE@
prefix=@prefix@#
datadir=@datadir@#
packagedir=@packagedir@#
infodir=@infodir@#
TEX=@TEX@
MAKEINFO=@MAKEINFO@ @MAKEINFO_MACROS@
INSTALL_INFO=@INSTALL_INFO@
INSTALL=@INSTALL@
INSTALL_DATA=@INSTALL_DATA@
TEXIHTML=texi2html
TEXINDEX=texindex
MKINSTALLDIRS = ../mkinstalldirs
DVIPS=dvips
TEXIFILES = auctex.texi install.texi wininstall.texi intro.texi \
	changes.texi todo.texi faq.texi

all: auctex.dvi tex-ref.dvi auctex

dist: auctex INSTALL INSTALL.windows README CHANGES TODO FAQ \
	auctex_toc.html auctex.ps

auctex_toc.html: auctex.texi
	$(TEXIHTML) -split_node auctex.texi

tex-ref.dvi: tex-ref.tex
	$(TEX) tex-ref
	@echo "**********************************************************"
	@echo "** doc/tex-ref.dvi may now be printed (1 page)"
	@echo "**********************************************************"

auctex.dvi: auctex.texi
	-$(TEX) "\nonstopmode\input auctex.texi"
	-$(TEXINDEX) auctex.ky
	-$(TEXINDEX) auctex.fn
	-$(TEXINDEX) auctex.vr
	-$(TEXINDEX) auctex.cp
	-$(TEX) "\nonstopmode\input auctex.texi"
	@echo "**********************************************************"
	@echo "** If this gave trouble, maybe you need to install"
	@echo "** a newer version of texinfo?"
	@echo "** doc/auctex.dvi may now be printed (70+ pages)"
	@echo "**********************************************************"

# dvips spews two error lines.  I don't know why.
auctex.ps: auctex.dvi
	$(DVIPS) auctex.dvi -o auctex.ps

auctex: $(TEXIFILES)
	-$(MAKEINFO) auctex.texi
	@echo "**********************************************************"
	@echo "** If this gave trouble, maybe you need to install"
	@echo "** a newer version of texinfo?"
	@echo "**********************************************************"

INSTALL: install.texi
	-$(MAKEINFO) -D rawfile --no-headers --no-validate \
		install.texi --output INSTALL

INSTALL.windows: wininstall.texi
	-$(MAKEINFO) -D rawfile --no-headers --no-validate \
		wininstall.texi --output INSTALL.windows

README: intro.texi
	-$(MAKEINFO) -D rawfile --no-headers --no-validate \
		intro.texi --output README

CHANGES: changes.texi
	-$(MAKEINFO) -D rawfile --no-headers --no-validate \
		changes.texi --output CHANGES

HISTORY: history.texi
	-$(MAKEINFO) -D rawfile --no-headers --no-validate \
		history.texi --output HISTORY

TODO: todo.texi macros.texi
	-$(MAKEINFO) -D rawfile --no-headers --no-validate \
		todo.texi --output TODO

FAQ: faq.texi macros.texi
	-$(MAKEINFO) -D rawfile --no-headers --no-validate \
		faq.texi --output FAQ

install: auctex
	-$(MKINSTALLDIRS) $(infodir)
	$(INSTALL_DATA) auctex $(infodir)
	for x in auctex-*; do \
	  if [ -r $$x ]; then \
	    $(INSTALL_DATA) $$x $(infodir) ; \
	  fi; \
	done
	-$(INSTALL_INFO)  --info-dir=$(infodir) auctex

clean:
	rm -f *.dvi *.ps *.aux *.cp *.fn *.info *.ky *.log *~ \#*\# \
		*.tp *.vr *.pg *.toc *.tp *.bak *.cps *.kys *.tps \
		*.fns *.vrs *.pgs *.tmp auctex auctex-* *.html INSTALL \
		INSTALL.windows README CHANGES HISTORY TODO FAQ

distclean: clean
	rm -f Makefile
