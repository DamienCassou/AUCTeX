prefix=@prefix@$(null)
datadir=@datadir@$(null)
packagedir=@packagedir@$(null)
infodir=@infodir@$(null)
TEX=@TEX@
PDFTEX=@PDFTEX@
TEXINFOINCLUDES=-I $${TEXIPWD}.
MAKEINFO=@MAKEINFO@ @MAKEINFO_MACROS@
INSTALL_INFO=@INSTALL_INFO@
INSTALL=@INSTALL@
INSTALL_DATA=@INSTALL_DATA@
DESTDIR=
TEXI2HTML=@TEXI2HTML@
TEXI2DVI=@TEXI2DVI@
TEXI2PDF=@TEXI2PDF@
MKINSTALLDIRS = ../mkinstalldirs
DVIPS=@DVIPS@
TEXIFILES = auctex.texi install.texi wininstall.texi intro.texi \
	changes.texi todo.texi faq.texi macros.texi quickstart.texi
DISTTEXTS = ../README ../INSTALL ../TODO ../INSTALL.windows ../FAQ ../CHANGES

all: auctex.dvi tex-ref.dvi auctex.info

dist: auctex.info $(DISTTEXTS) \
	html/auctex_toc.html auctex.ps auctex.pdf tex-ref.ps tex-ref.pdf

.PHONY: all dist install disttexts clean distclean maintainer-clean

html/auctex_toc.html: auctex.texi
	rm -rf html
	mkdir html
	cd html;TEXIPWD=../;$(TEXI2HTML) -split_node $(TEXINFOINCLUDES) ../auctex.texi && \
	if [ -d auctex ];then mv auctex/* .; rm -rf auctex; fi

tex-ref.dvi: tex-ref.tex
	$(TEX) tex-ref

tex-ref.ps: tex-ref.dvi
	$(DVIPS) tex-ref.dvi -Ppdf -o tex-ref.ps

tex-ref.pdf: tex-ref.tex
	$(PDFTEX) tex-ref.tex

auctex.dvi: $(TEXIFILES)
	$(TEXI2DVI) $(TEXINFOINCLUDES) auctex.texi

auctex.pdf: $(TEXIFILES)
	$(TEXI2PDF) $(TEXINFOINCLUDES) auctex.texi

auctex.ps: auctex.dvi
	$(DVIPS) auctex.dvi -Ppdf -o auctex.ps

auctex.info: $(TEXIFILES)
	$(MAKEINFO) $(TEXINFOINCLUDES) auctex.texi

../INSTALL: install.texi macros.texi
	$(MAKEINFO) $(TEXINFOINCLUDES) -D rawfile --no-headers  \
		install.texi --output $@

../INSTALL.windows: wininstall.texi macros.texi
	$(MAKEINFO) $(TEXINFOINCLUDES) -D rawfile --no-headers  \
		wininstall.texi --output $@

../README: intro.texi macros.texi
	$(MAKEINFO) $(TEXINFOINCLUDES) -D rawfile --no-headers  \
		intro.texi --output $@

../CHANGES: changes.texi macros.texi
	$(MAKEINFO) $(TEXINFOINCLUDES) -D rawfile --no-headers  \
		changes.texi --output $@

../TODO: todo.texi macros.texi
	$(MAKEINFO) $(TEXINFOINCLUDES) -D rawfile --no-headers  \
		todo.texi --output $@

../FAQ: faq.texi macros.texi
	$(MAKEINFO) $(TEXINFOINCLUDES) -D rawfile --no-headers  \
		faq.texi --output $@

disttexts: $(DISTTEXTS)

install: auctex.info
	-$(MKINSTALLDIRS) $(DESTDIR)$(infodir)
	rm -f $(DESTDIR)$(infodir)/auctex $(DESTDIR)$(infodir)/auctex-*
	$(INSTALL_DATA) auctex.info $(DESTDIR)$(infodir)
	for x in auctex.info-*; do \
	  if [ -r $$x ]; then \
	    $(INSTALL_DATA) $$x $(DESTDIR)$(infodir) ; \
	  fi; \
	done
	-$(INSTALL_INFO)  --info-dir=$(DESTDIR)$(infodir) auctex.info

clean:
	rm -f *.dvi *.ps *.pdf *.aux *.cp *.fn *.info *.ky *.log *~ \#*\# \
		*.tp *.vr *.pg *.toc *.tp *.bak *.cps *.kys *.tps \
		*.fns *.vrs *.pgs *.tmp auctex.info auctex.info-* *.html \
	rm -rf html

distclean: clean
	rm -f Makefile

maintainer-clean: distclean
	rm -rf ../INSTALL INSTALL.windows README CHANGES HISTORY TODO FAQ

