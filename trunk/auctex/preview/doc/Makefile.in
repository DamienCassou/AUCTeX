prefix=@prefix@$(null)
exec_prefix=@exec_prefix@$(null)
libdir=@libdir@$(null)
packagedir=@packagedir@$(null)
datadir=@datadir@$(null)
infodir=@infodir@$(null)
TEX=@TEX@
TEXINFOINCLUDES=-I $${TEXIPWD}../../doc
TEXI2HTML=@TEXI2HTML@
TEXI2DVI=@TEXI2DVI@
TEXI2PDF=@TEXI2PDF@
DVIPS=dvips
PERL=@PERL@
MAKEINFO=@MAKEINFO@ @MAKEINFO_MACROS@
INSTALL_INFO=@INSTALL_INFO@

DESTDIR=
INSTALL=@INSTALL@
INSTALL_DATA=@INSTALL_DATA@
MKINSTALLDIRS = ../mkinstalldirs
TEXIFILES = copying.texi faq.texi macros.texi \
	preview-dtxdoc.texi preview-latex.texi problems.texi \
	readme.texi todo.texi

DISTTEXTS = ../README ../PROBLEMS ../TODO ../FAQ

all: preview-latex.dvi preview-latex.info

preview-latex/index.html: $(TEXIFILES)
	rm -f preview-latex/*
	$(TEXI2HTML) $(TEXINFOINCLUDES) preview-latex.texi

html-docs: preview-latex/index.html

preview-dtxdoc.texi: ../latex/preview.dtx preview-dtxdoc.pl
	-$(PERL) preview-dtxdoc.pl ../latex/preview.dtx preview-dtxdoc.texi

preview-latex.dvi: $(TEXIFILES)
	$(TEXI2DVI) $(TEXINFOINCLUDES) preview-latex.texi

preview-latex.ps: preview-latex.dvi
	$(DVIPS) preview-latex.dvi -Ppdf -o preview-latex.ps

preview-latex.pdf: $(TEXIFILES)
	$(TEXI2PDF) $(TEXINFOINCLUDES) preview-latex.texi

preview-latex.info: $(TEXIFILES)
	$(MAKEINFO) $(TEXINFOINCLUDES) preview-latex.texi

disttexts: $(DISTTEXTS)

../README: readme.texi ../../doc/macros.texi
	$(MAKEINFO) $(TEXINFOINCLUDES) -D rawfile --no-headers  \
		readme.texi --output ../README

../FAQ: faq.texi ../../doc/macros.texi
	$(MAKEINFO) $(TEXINFOINCLUDES) -D rawfile --no-headers  \
		--number-sections faq.texi --output ../FAQ

../PROBLEMS: problems.texi ../../doc/macros.texi
	$(MAKEINFO) $(TEXINFOINCLUDES) -D rawfile --no-headers  \
		--number-sections problems.texi --output ../PROBLEMS

../TODO: todo.texi ../../doc/macros.texi
	$(MAKEINFO) $(TEXINFOINCLUDES) -D rawfile --no-headers  \
		todo.texi --output ../TODO

.PHONY: install disttexts clean maintainer-clean html-docs all

install: preview-latex.info
	-$(MKINSTALLDIRS) $(DESTDIR)$(infodir)
	for x in preview-latex.info* ; do \
		$(INSTALL_DATA) $$x $(DESTDIR)$(infodir) ; \
	done
	-$(INSTALL_INFO)  --info-dir=$(DESTDIR)$(infodir) preview-latex.info

clean: 
	rm -f *.ps *.pdf *.aux *.cp *.fn *.ky *.log *~ \#*\# \
		*.tp *.vr *.pg *.toc *.tp *.bak *.cps *.kys *.tps \
		*.fns *.vrs *.pgs *.dvi *.html *.tmp \
		preview-latex/*

maintainer-clean: clean
	rm -f *.info* preview-dtxdoc.texi auto.texi $(DISTTEXTS)
